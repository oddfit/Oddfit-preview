<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OddFit — Rewriting the Size Guide</title>

  <meta name="description" content="OddFit brings Indo-western fashion with inclusive sizes like S+, M+, L+, XL+. Shop stylish comfort wear for all body types." />
  <meta name="keywords" content="OddFit, Indo-western, fashion, inclusive sizing, S+, M+, L+, XL+, comfort wear, ethnic wear" />
  <meta name="author" content="OddFit Team" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  
  <!-- CSS -->
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <div class="nav-left">
      <i class="fas fa-bars menu-icon" onclick="toggleDrawer()"></i>
    </div>
    <div class="nav-center">
      <div class="logo">
        <img src="logo_mini.png" alt="OddFit Logo" />
      </div>
      <div class="search-bar" id="search-bar" style="display: none;">
        <div class="search-wrapper">
          <input type="text" id="search-input" placeholder="Search..." oninput="handleSearch()" />
          <i class="fas fa-search search-confirm-icon" onclick="handleSearch(true)"></i>
        </div>
      </div>
    </div>
    <div class="nav-right">
      <i class="fas fa-search" id="nav-search-icon" onclick="event.stopPropagation(); toggleSearchBar()"></i>
      <i class="fas fa-heart"></i>
      <i class="fas fa-shopping-bag"></i>
    </div>
  </header>

  <!-- Drawer -->
  <aside id="drawer" class="drawer">
    <div class="drawer-header">
      <i class="fas fa-times close-icon" onclick="toggleDrawer()"></i>
    </div>
    <ul>
      <li><a href="#" onclick="scrollToSection('category-carousel'); toggleDrawer();">Shop Women</a></li>
      <li><a href="#" onclick="showErrorPopup(); toggleDrawer();">Shop Men</a></li>
      <li><a href="#">New Arrivals</a></li>
      <li><a href="#">Sale</a></li>
      <li><a href="#">Contact</a></li>
      <li><a href="#">Login</a></li>
    </ul>
  </aside>

  <!-- Hero -->
  <main>
    <section class="hero">
      <img src="banner.png" alt="OddFit Hero Banner" />
      <div class="cta-buttons">
        <button class="cta-button" onclick="scrollToSection('category-carousel')">SHOP WOMENS</button>
        <button class="cta-button" onclick="showErrorPopup()">SHOP MENS</button>
      </div>
    </section>

    <!-- Info Boxes -->
    <section class="info-boxes">
      <div class="box pink">
        <h3>Find Your Fit+</h3>
        <p>In-between sizes? We’ve got you covered.</p>
        <button class="box-button">Explore Sizes</button>
      </div>
      <div class="box blue">
        <h3>Made for Real Bodies</h3>
        <p>No filters. No fuss.<br>Just fashion that fits.</p>
        <button class="box-button">See Our Fit Philosophy</button>
      </div>
    </section>

    <!-- Categories -->
    <section class="category-carousel" id="category-carousel">
      <h2>Shop by Category</h2>
      <div class="category-track" id="category-track"></div>
    </section>

    <!-- Product Grid -->
    <section id="product-list" class="product-grid hidden"></section>
  </main>

  <!-- Back to Top -->
  <button id="backToTop" title="Go to top">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Error Popup -->
  <div id="errorPopup" class="popup-overlay" style="display: none;">
    <div class="popup-content">
      <img src="tape-animal.png" alt="Error Illustration" />
      <h2>Oops! We lost the fit.</h2>
      <p>But hey, we're all about making things fit, We will head back and fix it!</p>
      <button onclick="closePopup()">Go back home</button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    let allProducts = [];

    async function loadProducts() {
      const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQl-Wz3PrELBXNohvmU8-HJ1FEedmQJou9nvrPlrO5ix4VcKyE3-S5AmEZI-oCM1RRspIa2Jjcz8S9n/pub?gid=0&single=true&output=csv';
      const res = await fetch(sheetURL);
      const csvText = await res.text();
      const parsed = Papa.parse(csvText, { header: true, skipEmptyLines: true });
      allProducts = parsed.data;
      renderCategories([...new Set(allProducts.map(p => p.category))]);
    }

    function renderCategories(categories) {
      const track = document.getElementById('category-track');
      track.innerHTML = categories.map(cat => `
        <div class="category-card" onclick="filterByCategory('${cat}'); scrollToSection('product-list')">
          <img src="${cat.toLowerCase()}.png" alt="${cat}" />
          <p>${cat}</p>
        </div>
      `).join('');
    }

    function renderProducts(products) {
      const container = document.getElementById('product-list');
      container.classList.remove("hidden");
      let heading = products.length ? `${products[0].category} - Products` : 'Products';
      let html = `<h2>${heading}</h2><div class="product-grid-container">`;
      html += products.map(p => `
        <div class="product-card-modern">
          <div class="product-image-wrapper">
            <img src="${p.image_url}" alt="${p.product_name}" class="product-img" />
            <i class="fas fa-heart wishlist-icon"></i>
          </div>
          <div class="product-info">
            <h3 class="product-name">${p.product_name}</h3>
            <p class="product-meta">${p.color} | ${p.size}</p>
            <p class="product-category">${p.category}</p>
            <div class="product-bottom">
              <span class="product-price">₹${p.price}</span>
              <button class="add-to-bag">Add to Bag</button>
            </div>
          </div>
        </div>
      `).join('');
      html += '</div>';
      container.innerHTML = html;
    }

    function handleSearch(shouldScroll = false) {
      const searchTerm = document.getElementById('search-input').value.toLowerCase();
      const filtered = allProducts.filter(p =>
        p.product_name.toLowerCase().includes(searchTerm) ||
        p.category.toLowerCase().includes(searchTerm) ||
        p.color.toLowerCase().includes(searchTerm)
      );
      renderProducts(filtered);
      if (shouldScroll && filtered.length > 0) {
        scrollToSection("product-list");
      }
    }

    function filterByCategory(cat) {
      const filtered = allProducts.filter(p => p.category.toLowerCase() === cat.toLowerCase());
      renderProducts(filtered);
    }

    function toggleDrawer() {
      document.getElementById("drawer").classList.toggle("open");
    }

    function scrollToSection(id) {
      const el = document.getElementById(id);
      if (el) el.scrollIntoView({ behavior: 'smooth' });
    }

    function toggleSearchBar() {
      const searchBar = document.getElementById("search-bar");
      const logo = document.querySelector(".logo");
      const isHidden = searchBar.style.display === "none" || searchBar.style.display === "";

      if (isHidden) {
        searchBar.style.display = "block";
        logo.style.marginRight = "20px";
        document.getElementById("search-input").focus();
        document.addEventListener("click", handleOutsideClick);
        document.addEventListener("keydown", handleEscapeKey);
      } else {
        closeSearchBar();
      }

      function handleOutsideClick(e) {
        if (!searchBar.contains(e.target) && e.target.id !== "nav-search-icon") {
          closeSearchBar();
        }
      }

      function handleEscapeKey(e) {
        if (e.key === "Escape") {
          closeSearchBar();
        }
      }

      function closeSearchBar() {
        searchBar.style.display = "none";
        logo.style.marginRight = "auto";
        document.removeEventListener("click", handleOutsideClick);
        document.removeEventListener("keydown", handleEscapeKey);
      }
    }

    function closePopup() {
      document.getElementById("errorPopup").style.display = "none";
    }

    function showErrorPopup() {
      document.getElementById("errorPopup").style.display = "flex";
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadProducts();

      // Back to top visibility
      window.onscroll = function () {
        const btn = document.getElementById("backToTop");
        btn.style.display = (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) ? "block" : "none";
      };

      // Scroll to top click
      document.getElementById("backToTop").addEventListener("click", function () {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });

      // Reset scroll on reload
      window.onbeforeunload = function () {
        window.scrollTo(0, 0);
      };
    });
  </script>
</body>
</html>
